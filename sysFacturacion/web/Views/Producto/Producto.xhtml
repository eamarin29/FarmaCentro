<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <body>
        <ui:composition template="./../../Plantilla/Plantilla.xhtml">
            <ui:define name="content">
                <h3 class="titulo_gestion"> Gestión de Productos</h3>
                <h:form id="frmNuevoProducto">
                    <p:growl id="message" showDetail="true" />
                    <p:dialog id="dgNuevoProducto" widgetVar="dialogNuevoProducto" resizable="false"
                              showEffect="explode" width="1300px"
                              hideEffect="explode" modal="true" header="Crear un nuevo Producto">

                        <table>
                            <tr>

                                <td> <p:outputLabel value="Código de barras:"></p:outputLabel> </td> 
                                <p:spacer></p:spacer>
                                <td> <p:inputText style="text-transform:uppercase;"  value="#{productoBean.producto.codBarras}"></p:inputText>  </td> 

                                <td> <p:outputLabel value="Nombre:"></p:outputLabel> </td> 
                                <td>   <p:inputText style="text-transform:uppercase;"  value="#{productoBean.producto.nombre}"></p:inputText> </td> 

                            </tr>
                            <tr>

                                <td>  <p:outputLabel value="Stock mínimo (U):"></p:outputLabel> </td> 
                                <td>  <p:inputNumber  value="#{productoBean.producto.stockMinUni}">
                                        <f:convertNumber type="number" pattern="#0" />
                                    </p:inputNumber> </td> 
                                <td>   <p:outputLabel value="Stock actual (U):"></p:outputLabel> </td> 
                                <td>   <p:inputNumber  value="#{productoBean.producto.stockActUni}">
                                        <f:convertNumber type="number" pattern="#0" />
                                    </p:inputNumber>  </td> 
                            </tr>
                        </table>
                        <br></br>
                        <table> 
                            <tr>
                                <td width="100px;">
                                </td>
                                <td width="100px;">
                                    Cant. paquete
                                </td> 
                                <td width="100px;">
                                    Desc. paquete
                                </td>
                                <td width="100px;">
                                    Uni. paquete
                                </td>
                                <td width="140px;">
                                    $Compra
                                </td>
                                <td width="110px;">
                                    %Desc. Compra
                                </td>
                                <td width="140px;">
                                    $Compra Real
                                </td>
                                <td width="110px;"> 
                                    %Utilidad
                                </td>
                                <td width="140px;">
                                    $Venta Sugerido
                                </td>
                                <td width="140px;">
                                    $Venta Real
                                </td>
                            </tr>
                            <tr>
                                <td>  
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtCantidadPaquete}" style="width: 70px;" placeholder="100" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtDescripcionPaquete}" style="width: 70px;" placeholder="UNI" ></p:inputText>
                                </td> 
                                <td> X <p:inputText binding="#{productoBean.txtUnidadXPaquete}" style="width: 70px;"  placeholder="1"></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtCompra}" style="width: 100px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtDescuentoCompra}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtCompraReal}" style="width: 100px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtPorcentajeUtilidad}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtVentaSugerida}" style="width: 100px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtVentaReal}" style="width: 100px;" ></p:inputText>
                                </td> 

                            </tr>

                            <tr>
                                <td>
                                    <p:selectBooleanCheckbox style="background-color: white;" value="#{productoBean.check1}">
                                        <p:ajax update="" listener="#{productoBean.selectCheck1()}" />
                                    </p:selectBooleanCheckbox>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtCantidadPaquete1}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtDescripcionPaquete1}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td> X <p:inputText binding="#{productoBean.txtUnidadXPaquete1}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtCompra1}" style="width: 100px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtDescuentoCompra1}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtCompraReal1}" style="width: 100px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtPorcentajeUtilidad1}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtVentaSugerida1}" style="width: 100px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtVentaReal1}" style="width: 100px;" ></p:inputText>
                                </td> 
                            </tr>

                            <tr>
                                <td>
                                    <p:selectBooleanCheckbox style="background-color: white;" value="#{productoBean.check2}">
                                        <p:ajax update="" listener="#{productoBean.selectCheck2()}" />
                                    </p:selectBooleanCheckbox>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtCantidadPaquete2}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtDescripcionPaquete2}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td> X <p:inputText binding="#{productoBean.txtUnidadXPaquete2}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtCompra2}" style="width: 100px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtDescuentoCompra2}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtCompraReal2}" style="width: 100px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtPorcentajeUtilidad2}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtVentaSugerida2}" style="width: 100px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtVentaReal2}" style="width: 100px;" ></p:inputText>
                                </td> 
                            </tr>

                            <tr>
                                <td>
                                    <p:selectBooleanCheckbox style="background-color: white;" value="#{productoBean.check3}">
                                        <p:ajax update="" listener="#{productoBean.selectCheck3()}" />
                                    </p:selectBooleanCheckbox>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtCantidadPaquete3}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtDescripcionPaquete3}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td>X <p:inputText binding="#{productoBean.txtUnidadXPaquete3}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtCompra3}" style="width: 100px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtDescuentoCompra3}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtCompraReal3}" style="width: 100px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtPorcentajeUtilidad3}" style="width: 70px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtVentaSugerida3}" style="width: 100px;" ></p:inputText>
                                </td> 
                                <td> <p:inputText binding="#{productoBean.txtVentaReal3}" style="width: 100px;" ></p:inputText>
                                </td> 
                            </tr>

                        </table>


                        <br></br>
                        <p:commandButton id="btnGuardarProductoNuevo" 
                                         action="#{productoBean.nuevoProducto()}" 
                                         update="frmMostrarProductos:tablaProductos, message"
                                         title="Guardar registro" icon="ui-icon-guardar2">
                        </p:commandButton>
                        <p:commandButton style="float: right;" title="Cancelar" value="Cancelar" oncomplete="PF('dialogNuevoProducto').hide();">
                        </p:commandButton>
                    </p:dialog>
                </h:form>
                <h:form id="frmModificarProducto">
                    <p:growl id="message" showDetail="true" />
                    <p:dialog id="dgModificarProducto" widgetVar="dialogModificarProducto" resizable="false" showEffect="explode"
                              hideEffect="explode" modal="true" header="Modificar producto">
                        <p:panelGrid columns="2" style="margin: 0 auto; width: 600px;">

                            <p:outputLabel value="Nombre"></p:outputLabel>
                            <p:inputText style="width: 100%; text-transform:uppercase;" value="#{productoBean.producto.nombre}"></p:inputText>

                            <p:outputLabel value="Precio Compra $"></p:outputLabel>
                            <p:inputNumber style="width: 100%;" value="#{productoBean.producto.precioCompra}"></p:inputNumber>

                            <p:outputLabel value="Stock mínimo (Un)"></p:outputLabel>
                            <p:inputNumber style="width: 100%;" value="#{productoBean.producto.stockMinUni}">
                                <f:convertNumber type="number" pattern="#0" />
                            </p:inputNumber>

                            <p:outputLabel value="Stock actual (Un)"></p:outputLabel>
                            <p:inputNumber style="width: 100%;"  value="#{productoBean.producto.stockActUni}">
                                <f:convertNumber type="number" pattern="#0" />
                            </p:inputNumber>

                        </p:panelGrid>
                        <br></br>
                        <p:commandButton id="btnGuardarPoductoModificado" 
                                         action="#{productoBean.modificarProducto()}" 
                                         update="frmMostrarProductos:tablaProductos, message"
                                         title="Guardar cambios" icon="ui-icon-guardar2">
                        </p:commandButton>
                        <p:commandButton style="float: right;" title="Cancelar" value="Cancelar" oncomplete="PF('dialogModificarProducto').hide();">
                        </p:commandButton>
                    </p:dialog>
                </h:form>          
                <h:form id="frmEliminarProducto">
                    <p:growl id="message" showDetail="true" />
                    <p:dialog id="dgEliminarProducto" widgetVar="dialogEliminarProducto" resizable="false" showEffect="explode"
                              hideEffect="explode" modal="true" header="Eliminar Producto">

                        <h:outputText value="¿Seguro que desea eliminar este producto?"></h:outputText>
                        <br></br>
                        <br></br>
                        <p:commandButton id="yes"  
                                         action="#{productoBean.eliminarProducto()}" 
                                         update="frmMostrarProductos:tablaProductos, message"
                                         title="Eliminar producto" icon="ui-icon-yes">
                        </p:commandButton>
                        <p:commandButton style="float: right;" title="Cancelar" value="Cancelar" oncomplete="PF('dialogEliminarProducto').hide();">
                        </p:commandButton>
                    </p:dialog>
                </h:form>
                <h:form>
                    <p:commandButton value="Nuevo Producto" actionListener="#{productoBean.prepararNuevoProdcuto()}" 
                                     oncomplete="PF('dialogNuevoProducto').show();"
                                     update=":frmNuevoProducto">
                    </p:commandButton> 
                </h:form>  
                <h:form id="frmAgregarProducto">
                    <p:growl id="message" showDetail="true" />
                    <p:dialog id="dgAgregarProducto" widgetVar="dialogAgregarProducto" resizable="false" showEffect="explode"
                              hideEffect="explode" modal="true" header="Agregar producto">
                        <p:panelGrid columns="2" style="margin: 0 auto; width: 600px;">

                            <p:outputLabel value="Adicionar al Stock actual (U)"></p:outputLabel>
                            <p:inputNumber style="width: 100%;" value="#{productoBean.adicionarProductos}">
                                <f:convertNumber type="number" pattern="#0" />
                            </p:inputNumber>


                        </p:panelGrid>
                        <br></br>
                        <p:commandButton id="btnGuardarPoductoModificado" 
                                         action="#{productoBean.adicionarProductosStock()}" 
                                         update="frmMostrarProductos:tablaProductos, message"
                                         title="Guardar cambios" icon="ui-icon-guardar2">
                        </p:commandButton>
                        <p:commandButton style="float: right;" title="Cancelar" value="Cancelar"
                                         action="#{productoBean.cancelarAdicionarProductosStock()}" 
                                         update="frmMostrarProductos:tablaProductos, message">
                        </p:commandButton>
                    </p:dialog>
                </h:form>  
                <br></br>
                <h:form id="frmMostrarProductos">
                    <p:dataTable id="tablaProductos" var="pr" value="#{productoBean.listaProductos}" rows="3"
                                 paginator="true" rowsPerPageTemplate="3,5,10,20,40,80,160,320"
                                 emptyMessage="No hay Productos registrados hasta el momento."
                                 widgetVar="parametrosTabla" paginatorPosition="bottom"
                                 filteredValue="#{productoBean.filtroProductos}" style="width: 100%;"
                                 scrollable="true" scrollWidth="99.9%" >

                        <f:facet name="header">
                            <p:outputPanel>
                                <h:outputText value="Buscar en cualquier columna: " />
                                <p:spacer></p:spacer>
                                <p:inputText id="globalFilter" onkeyup="PF('parametrosTabla').filter()" style="width:150px" placeholder="Buscar..."/>
                            </p:outputPanel>
                        </f:facet>

                        <p:column style="text-align: center;  width: 180px;"  filterBy="#{pr.codBarras}" filterMatchMode="contains" headerText="Código de Barras">
                            <h:outputText value="#{pr.codBarras}"></h:outputText>
                        </p:column>
                        <p:column style="text-align: center; width: 250px;" filterBy="#{pr.nombre}" filterMatchMode="contains"  headerText="Descripción del Producto">
                            <h:outputText value="#{pr.nombre}"></h:outputText>
                        </p:column>
                        <p:column style="text-align: center; width: 130px;" filterBy="#{pr.paquete}" filterMatchMode="contains"  headerText="Descripción Paquete">
                            <h:outputText value="#{pr.paquete}"></h:outputText>
                        </p:column>
                        <p:column style="text-align: center; width: 140px;" filterBy="#{pr.precioCompra}" filterMatchMode="contains" headerText="Precio Compra">
                            <h:outputText value="#{pr.precioCompra}">
                                <f:convertNumber type="currency" currencySymbol="$" locale="en_US" />
                            </h:outputText>    
                        </p:column>
                        <p:column style="text-align: center; width: 130px;" filterBy="#{pr.porcentajeDescuento}" filterMatchMode="contains"  headerText="%Descuento Compra">
                            <h:outputText value="#{pr.porcentajeDescuento}"></h:outputText>
                        </p:column>
                        <p:column style="text-align: center; width: 150px;" filterBy="#{pr.precioCompraReal}" filterMatchMode="contains" headerText="Precio Compra Real">
                            <h:outputText value="#{pr.precioCompraReal}">
                                <f:convertNumber type="currency" currencySymbol="$" locale="en_US" />
                            </h:outputText>    
                        </p:column>
                        <p:column style="text-align: center; width: 140px;" filterBy="#{pr.porcentajeUtilidad}" filterMatchMode="contains"  headerText="% de Utilidad">
                            <h:outputText value="#{pr.porcentajeUtilidad}"></h:outputText>
                        </p:column>
                        <p:column style="text-align: center; width: 140px;" filterBy="#{pr.precioVentaReal}" filterMatchMode="contains" headerText="Precio de Venta">
                            <h:outputText value="#{pr.precioVentaReal}">
                                <f:convertNumber type="currency" currencySymbol="$" locale="en_US" />
                            </h:outputText>    
                        </p:column>
                        <p:column style="text-align: center; width: 140px;" filterBy="#{pr.stockMinUni}" filterMatchMode="contains" headerText="Stock mínimo (U)">
                            <h:outputText value="#{pr.stockMinUni}"></h:outputText>
                        </p:column>
                        <p:column style="text-align: center; width: 140px;" filterBy="#{pr.stockActUni}" filterMatchMode="contains" headerText="Stock actual (U)">
                            <h:outputText value="#{pr.stockActUni}"></h:outputText>
                        </p:column>
                        <p:column headerText="Acciones" style="width: 200px;">
                            <p:commandButton title="Modificar registro" oncomplete="PF('dialogModificarProducto').show();"
                                             update=":frmModificarProducto" icon="ui-icon-modificar" >
                                <f:setPropertyActionListener target="#{productoBean.producto}" value="#{pr}">
                                </f:setPropertyActionListener>     
                            </p:commandButton>
                            <p:commandButton  title="Eliminar registro" icon="ui-icon-delete2" 
                                              oncomplete="PF('dialogEliminarProducto').show();" update=":frmEliminarProducto">  
                                <f:setPropertyActionListener target="#{productoBean.producto}" value="#{pr}">
                                </f:setPropertyActionListener> 
                            </p:commandButton> 
                            <p:commandButton  title="Agregar más productos" icon="ui-icon-agregar" 
                                              oncomplete="PF('dialogAgregarProducto').show();" update=":frmAgregarProducto">  
                                <f:setPropertyActionListener target="#{productoBean.producto}" value="#{pr}">
                                </f:setPropertyActionListener> 
                            </p:commandButton> 
                        </p:column> 
                    </p:dataTable>    
                </h:form> 
            </ui:define>
        </ui:composition>
    </body>
</html>
